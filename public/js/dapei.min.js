$(function(){function m(e,t){var n='<div class="itemDragContainer"><img class="" src="'+e.img+'" /></div>',r="dragItemId"+p,i="#"+r;$(n).appendTo(t).attr("id",r),new NAVY.Resize(i),v.push(new NAVY.Drag(i,i,{left:e.left,top:e.top})),p++}function g(){var e,t,n,r,o;i=[],e=$("#content").find(".collectionContainer"),t=0,n=e.length;for(;t<n;t++)r=$(e[t]),o=r.offset(),i.push({obj:r,pos:{leftTop:o,rightBottom:{left:o.left+s.width,top:o.top+s.height}}})}var e,t,n,r,i,s,o=$("#dragWrapper"),u=o.offset(),a=$("body"),f={width:o.width(),height:o.height()},l={pageX:f.width+u.left,pageY:f.height+u.top},c=150,h=150,p=1,d=5,v=[];e=!1,t={},n=null,r={},$("#floatRight").on("mousedown",".dragItem",function(i){var s,c=$(this);return c.hasClass("dragItem")&&(e=!0,f.height=o.height(),l.pageY=f.height+u.top,t.img=c.find("img").attr("src"),s=c.offset(),r.left=i.pageX-s.left,r.top=i.pageY-s.top,n=c.clone().css({cursor:"pointer",position:"absolute",left:s.left,top:s.top}).attr("id","tempItemDrag").appendTo(a)),!1}),$(document).mouseup(function(o){var a,f,p,v,g,y,b,w,E,S;if(e){a=o.pageX,f=o.pageY;for(p=0,v=i.length;p<v;p++){g=i[p].obj,y=i[p].pos;if(a>u.left-c&&a<l.pageX&&f>y.leftTop.top-h&&f<y.rightBottom.top){b=a-y.leftTop.left-r.left,w=f-y.rightBottom.top-r.top,E=s.width-c-d,S=s.height-h-d,b=Math.min(E,Math.max(b,d)),w=Math.min(S,Math.max(w,d)),t.left=b,t.top=w+(f-y.leftTop.top-r.top-d),m(t,g);break}}return n.length&&n.remove(),e=!1,!1}}).mousemove(function(t){e&&n.length&&n.css({left:t.pageX-r.left,top:t.pageY-r.top})}),i=[],s={width:600,height:400},g(),$("#save").click(function(){var e=v.length,t=0;for(t=0;t<e;t++)v[t].setCursorDefault();$("#tempWrapper").html($("#dragWrapper").clone());for(t=0;t<e;t++)v[t].setCursorMove()})})